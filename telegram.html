<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Telegramé…ç½®ç¼–è¾‘å™¨</title>
    <style>
        :root {
            --primary: #007bff;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
        }
        body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .upload-section { border: 2px dashed var(--primary); padding: 2rem; text-align: center; margin-bottom: 2rem; }
        .config-section { border: 1px solid #dee2e6; border-radius: 0.25rem; padding: 1rem; margin-bottom: 1rem; }
        .item-card { background: #f8f9fa; padding: 1rem; margin-bottom: 1rem; border-radius: 0.25rem; }
        button { padding: 0.375rem 0.75rem; border-radius: 0.25rem; }
        .btn-primary { background: var(--primary); color: white; border: none; }
        .btn-danger { background: var(--danger); color: white; border: none; }
        .switch { position: relative; display: inline-block; width: 3rem; height: 1.5rem; }
        .switch input { opacity: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #ced4da; transition: .4s; border-radius: 1.5rem; }
        .slider:before { position: absolute; content: ""; height: 1.1rem; width: 1.1rem; left: 0.2rem; bottom: 0.2rem; background: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background: var(--primary); }
        input:checked + .slider:before { transform: translateX(1.5rem); }
    </style>
</head>
<body>
    <h1>ğŸ“ Telegramé…ç½®ç¼–è¾‘å™¨</h1>
    
    <div class="upload-section">
        <button class="btn-primary" onclick="loadDefaultConfig()">åŠ è½½é»˜è®¤é…ç½®</button>
        <p>æˆ–</p>
        <input type="file" id="fileInput" accept=".json" hidden>
        <button class="btn-primary" onclick="document.getElementById('fileInput').click()">ä¸Šä¼ é…ç½®æ–‡ä»¶</button>
    </div>

    <div class="config-section">
        <h2>è´¦å·é…ç½® <button class="btn-primary" onclick="addAccount()">+ æ·»åŠ </button></h2>
        <div id="accounts"></div>
    </div>

    <div class="config-section">
        <h2>æœºå™¨äººé…ç½® <button class="btn-primary" onclick="addBot()">+ æ·»åŠ </button></h2>
        <div id="bots"></div>
    </div>

    <div style="text-align: center; margin-top: 2rem;">
        <button class="btn-primary" onclick="downloadConfig()" style="padding: 1rem 2rem;">ğŸ’¾ ä¸‹è½½config.json</button>
    </div>

<script>
// åˆå§‹åŒ–é…ç½®
let currentConfig = { accounts: [], bots: [] };

// é¡µé¢åŠ è½½æ—¶å°è¯•è¯»å–é»˜è®¤é…ç½®
window.addEventListener('DOMContentLoaded', async () => {
    try {
        const response = await fetch('config.json');
        if(response.ok) {
            const config = await response.json();
            loadConfig(config);
        }
    } catch(e) {
        console.log('ä½¿ç”¨ç©ºç™½é…ç½®åˆå§‹åŒ–');
        addAccount();
        addBot();
    }
});

// é…ç½®åŠ è½½å‡½æ•°
function loadConfig(config) {
    // æ¸…ç©ºç°æœ‰é…ç½®
    document.getElementById('accounts').innerHTML = '';
    document.getElementById('bots').innerHTML = '';

    // åŠ è½½è´¦å·
    config.accounts.forEach(account => {
        const item = addAccount();
        item.querySelector('.api-id').value = account.api_id || '';
        item.querySelector('.api-hash').value = account.api_hash || '';
    });

    // åŠ è½½æœºå™¨äºº
    config.bots.forEach(bot => {
        const item = addBot();
        item.querySelector('.bot-id').value = bot.bot_id || '';
        item.querySelector('.bot-msg').value = bot.message || '';
        item.querySelector('.enable').checked = bot.enable !== false;
        item.querySelector('.click-button').checked = !!bot.click_button;
        item.querySelector('.button-data').value = bot.button_data || '';
        toggleButtonOptions(item);
    });
}

// æ–‡ä»¶ä¸Šä¼ å¤„ç†
document.getElementById('fileInput').addEventListener('change', async e => {
    const file = e.target.files[0];
    if (!file) return;

    try {
        const config = JSON.parse(await file.text());
        loadConfig(config);
    } catch(e) {
        alert('é…ç½®æ–‡ä»¶è§£æå¤±è´¥: ' + e.message);
    }
});

// åŠ¨æ€æ·»åŠ é…ç½®é¡¹
function addAccount() {
    const div = document.createElement('div');
    div.className = 'item-card';
    div.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem; align-items: center">
            <input type="number" placeholder="API ID" class="api-id" required>
            <input type="text" placeholder="API Hash" class="api-hash" required>
            <button class="btn-danger" onclick="this.parentElement.parentElement.remove()">åˆ é™¤</button>
        </div>
    `;
    document.getElementById('accounts').appendChild(div);
    return div;
}

function addBot() {
    const div = document.createElement('div');
    div.className = 'item-card';
    div.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem; align-items: center">
            <input type="text" placeholder="æœºå™¨äººID" class="bot-id" required>
            <input type="text" placeholder="ç­¾åˆ°å‘½ä»¤" class="bot-msg" required>
            <button class="btn-danger" onclick="this.parentElement.parentElement.remove()">åˆ é™¤</button>
        </div>
        <div style="margin-top: 1rem">
            <label style="display: flex; gap: 0.5rem; align-items: center">
                <span>å¯ç”¨ï¼š</span>
                <label class="switch">
                    <input type="checkbox" class="enable" checked>
                    <span class="slider"></span>
                </label>
            </label>
            
            <div style="margin-top: 0.5rem">
                <label style="display: flex; gap: 0.5rem; align-items: center">
                    <span>éœ€è¦ç‚¹å‡»æŒ‰é’®ï¼š</span>
                    <label class="switch">
                        <input type="checkbox" class="click-button">
                        <span class="slider"></span>
                    </label>
                </label>
                <input type="text" placeholder="æŒ‰é’®æ•°æ®" class="button-data" style="margin-top: 0.5rem; width: 100%; display: none">
            </div>
        </div>
    `;

    // äº‹ä»¶ç»‘å®š
    div.querySelector('.click-button').addEventListener('change', function() {
        div.querySelector('.button-data').style.display = this.checked ? 'block' : 'none';
    });

    document.getElementById('bots').appendChild(div);
    return div;
}

// ç”Ÿæˆä¸‹è½½æ–‡ä»¶
function downloadConfig() {
    const config = {
        accounts: [...document.querySelectorAll('.item-card')].filter(el => el.closest('#accounts'))
            .map(item => ({
                api_id: Number(item.querySelector('.api-id').value),
                api_hash: item.querySelector('.api-hash').value
            })),
        bots: [...document.querySelectorAll('.item-card')].filter(el => el.closest('#bots'))
            .map(item => ({
                bot_id: item.querySelector('.bot-id').value,
                message: item.querySelector('.bot-msg').value,
                enable: item.querySelector('.enable').checked,
                click_button: item.querySelector('.click-button').checked,
                button_data: item.querySelector('.click-button').checked 
                    ? item.querySelector('.button-data').value 
                    : undefined
            }))
    };

    // éªŒè¯é…ç½®
    if (!validateConfig(config)) {
        alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
        return;
    }

    // åˆ›å»ºä¸‹è½½
    const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'config.json';
    a.click();
    URL.revokeObjectURL(url);
}

// é…ç½®éªŒè¯
function validateConfig(config) {
    return config.accounts.every(a => a.api_id && a.api_hash) &&
           config.bots.every(b => b.bot_id && b.message && 
               (!b.click_button || b.button_data));
}

// è¾…åŠ©å‡½æ•°
function toggleButtonOptions(item) {
    const clickButton = item.querySelector('.click-button');
    item.querySelector('.button-data').style.display = clickButton.checked ? 'block' : 'none';
}

async function loadDefaultConfig() {
    try {
        const response = await fetch('config.json');
        const config = await response.json();
        loadConfig(config);
    } catch(e) {
        alert('é»˜è®¤é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥');
    }
}
</script>
</body>
</html>
